<div id="container">
    <div class="tailwind css-myl2ny css-exq74d css-gs60ek">
        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
            <div class="max-w-6xl mx-auto">
                <div class="text-card-foreground flex flex-col gap-6 rounded-xl border p-8 bg-white shadow-xl">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-3 bg-indigo-100 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-settings w-8 h-8 text-indigo-600"
                                aria-hidden="true">
                                <path
                                    d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915">
                                </path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h1 class="text-gray-900">MaxDiff Survey Setup</h1>
                            <p class="text-gray-600">Configure your survey parameters and concepts</p>
                        </div>
                        <div class="flex gap-2">
                            <button
                                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-9 px-4 py-2 has-[&gt;svg]:px-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-download w-4 h-4 mr-2"
                                    aria-hidden="true">
                                    <path d="M12 15V3"></path>
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <path d="m7 10 5 5 5-5"></path>
                                </svg>Export</button><label
                                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-9 px-4 py-2 has-[&gt;svg]:px-3 cursor-pointer">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="lucide lucide-upload w-4 h-4 mr-2"
                                    aria-hidden="true">
                                    <path d="M12 3v12"></path>
                                    <path d="m17 8-5-5-5 5"></path>
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                </svg>Import<input type="file" accept=".json" class="hidden"></label>
                        </div>
                    </div>

                    <div class="flex flex-col gap-2 w-full" [formGroup]="surveyForm">
                        <div class="bg-[#ececf0] text-muted-foreground h-9 items-center justify-center rounded-xl p-[3px] grid w-full grid-cols-4"
                            style="outline: none;">
                            <ng-container *ngFor="let tab of setUpTabs; let i = index">
                                <button (click)="selectTab(i)"
                                    class="focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:shrink-0 [&amp;_svg:not([class*='size-'])]:size-4"
                                    [ngClass]="selectedTab == i ? 'bg-white' : ''">
                                    {{tab}}<span *ngIf="i == 1">({{concept.controls.length}})</span></button>
                            </ng-container>
                        </div>


                        <div class="flex-1 outline-none space-y-6 mt-6">

                            <!-- Genral -->

                            <ng-container *ngIf="selectedTab == 0" formGroupName="general">
                                <div class="space-y-4">
                                    <div>
                                        <label
                                            class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2"
                                            for="title">Survey Title</label>
                                        <input data-slot="input" formControlName="survey_title"
                                            class="file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-white dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-gray-200 transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive"
                                            id="title" placeholder="Enter survey title"
                                            value="Home Design Preferences Survey">
                                    </div>
                                    <div><label
                                            class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2"
                                            for="description">Survey Description</label>
                                        <textarea data-slot="textarea" formControlName="survey_description"
                                            class="resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content w-full rounded-md border bg-gray-200 px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm min-h-[80px]"
                                            id="description"
                                            placeholder="Enter survey description">Help us understand your home and interior design preferences</textarea>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label
                                                class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2"
                                                for="numberOfSets">Number of Sets</label>
                                            <input type="number" formControlName="number_sets" data-slot="input"
                                                class="file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-white dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-gray-200 transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive"
                                                id="numberOfSets" min="1" max="20">
                                                 <p *ngIf="surveyForm.get('general').get('number_sets')?.errors?.min" class="text-red-600 text-sm">
                                                    *minimum 1 data set is required
                                                </p>
                                                <p *ngIf="surveyForm.get('general').get('number_sets')?.errors?.max" class="text-red-600 text-sm">
                                                    *maximum(20) data sets limit reached
                                                </p>
                                            <p class="text-gray-500 mt-1">How many question sets participants will
                                                see</p>
                                        </div>
                                        <div><label
                                                class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2"
                                                for="conceptsPerSet">Concepts Per Set</label>
                                            <input type="number" formControlName="concept_sets" data-slot="input"
                                                class="file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-white dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-gray-200 transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive"
                                                id="conceptsPerSet" min="3" max="10">
                                                <p *ngIf="surveyForm.get('general').get('concept_sets')?.errors?.min" class="text-red-600 text-sm">
                                                    *minimum 3 data set is required
                                                </p>
                                                <p *ngIf="surveyForm.get('general').get('concept_sets')?.errors?.max" class="text-red-600 text-sm">
                                                    *maximum(10) data sets limit reached
                                                </p>
                                            <p class="text-gray-500 mt-1">How many concepts to show at once</p>
                                        </div>
                                    </div>
                                    <div data-slot="alert" role="alert"
                                        class="relative w-full rounded-lg border px-4 py-3 text-sm grid has-[&gt;svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[&gt;svg]:gap-x-3 gap-y-0.5 items-start [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:translate-y-0.5 [&amp;&gt;svg]:text-current bg-card text-card-foreground">
                                        <div data-slot="alert-description"
                                            class="text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&amp;_p]:leading-relaxed">
                                            <strong>Recommendation:</strong> With {{surveyForm.get('general.number_sets')?.value}} sets and {{surveyForm.get('general.concept_sets')?.value}}
                                            concepts per set, you should have at least <strong>{{surveyForm.get('general.number_sets')?.value * surveyForm.get('general.concept_sets')?.value}}</strong> concepts
                                            for optimal coverage. You currently have <strong>{{concept.length}}</strong> concepts.
                                        </div>
                                    </div>
                                </div>
                            </ng-container>

                            <!-- concepts -->

                            <ng-container *ngIf="selectedTab == 1">
                                <div formGroupName="addNewConcept"
                                    class="text-card-foreground flex flex-col gap-6 rounded-xl border p-4 bg-blue-50 border-blue-200">
                                    <h3 class="text-gray-900 mb-4">Add New Concept</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div><label data-slot="label"
                                                class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2"
                                                for="newConceptName">Concept Name</label>
                                            <input data-slot="input" formControlName="concept_name"
                                                class="file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-white dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-gray-200 transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive"
                                                id="newConceptName" placeholder="e.g., Modern Kitchen" value="">
                                        </div>
                                        <div><label data-slot="label"
                                                class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2"
                                                for="newConceptImage">Image URL</label>
                                            <div class="flex gap-2">
                                                <input data-slot="input" formControlName="concept_image"
                                                    class="file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-white dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-gray-200 transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive flex-1"
                                                    id="newConceptImage" placeholder="https://images.unsplash.com/..."
                                                    value="">
                                                <button
                                                    type="button"
                                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition" (click)="upload.click()"
                                                    >
                                                    <svg xmlns="http://www.w3.org/2000/svg" 
                                                        fill="none" 
                                                        viewBox="0 0 24 24" 
                                                        stroke-width="2" 
                                                        stroke="currentColor" 
                                                        class="w-6 h-6 text-gray-700">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 16v-8m0 0l-3 3m3-3l3 3M4 20h16a1 1 0 001-1v-4a1 1 0 00-1-1H4a1 1 0 00-1 1v4a1 1 0 001 1z" />
                                                    </svg>
                                                    </button>
                                                           <input
                                                        (change)="handleInputChange($event)" #upload id="logo-upload" type="file"
                                                        accept="image/jpeg" class="hidden">


                                                <button (click)="addConcept()" [ngClass]="(surveyForm.get('addNewConcept.concept_name').value !== '' && surveyForm.get('addNewConcept.concept_image').value !== '')  ? 'bg-[#030213]' : 'bg-gray-400'"
                                                    class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive text-white hover:bg-primary/90 h-9 px-4 py-2 has-[&gt;svg]:px-3">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                        viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                        class="lucide lucide-plus w-4 h-4" aria-hidden="true">
                                                        <path d="M5 12h14"></path>
                                                        <path d="M12 5v14"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- <div class="space-y-2 max-h-[500px] overflow-y-auto" >
                                    <ng-container *ngFor="let concept of concepts; let i = index">
                                        <div *ngIf="concept.edit"
                                            class="text-card-foreground flex flex-col gap-6 rounded-xl border p-4 bg-amber-50 border-amber-200">
                                            <h3 class="text-gray-900 mb-4">Edit Concept</h3>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label data-slot="label"
                                                        class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2">Concept
                                                        Name</label><input data-slot="input"
                                                        class="file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-white dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-gray-200 transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive"
                                                        [value]="concept.name">
                                                </div>
                                                <div>
                                                    <label data-slot="label"
                                                        class="flex items-center gap-2 text-sm leading-none font-medium select-none mb-2">Image
                                                        URL</label><input data-slot="input"
                                                        class="file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-white dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-gray-200 transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive"
                                                        [value]="concept.imageUrl">
                                                </div>
                                            </div>
                                            <div class="flex gap-2 mt-4"><button (click)="save(i)"
                                                    class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive bg-primary text-white hover:bg-primary/90 h-9 px-4 py-2 has-[&gt;svg]:px-3">Save
                                                    Changes</button>
                                                <button (click)="cancel(i)"
                                                    class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-9 px-4 py-2 has-[&gt;svg]:px-3">Cancel</button>
                                            </div>
                                        </div>
                                        <div
                                            class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border p-4">
                                            <div class="flex items-center gap-4"><span class="text-gray-500 w-8">{{i +
                                                    1}}</span><img [src]="concept.imageUrl"
                                                    alt="Modern Office Workspace"
                                                    class="w-16 h-16 rounded object-cover">
                                                <div class="flex-1">
                                                    <p class="text-gray-900">{{concept.name}}</p>
                                                    <p class="text-gray-500 truncate max-w-md">
                                                        {{concept.imageUrl}}
                                                    </p>
                                                </div>
                                                <div class="flex gap-2">
                                                    <button (click)="editCard(i)"
                                                        class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                            stroke-width="2" stroke-linecap="round"
                                                            stroke-linejoin="round" class="lucide lucide-pen w-4 h-4"
                                                            aria-hidden="true">
                                                            <path
                                                                d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z">
                                                            </path>
                                                        </svg>
                                                    </button>
                                                    <button (click)="deleteConcept(i)"
                                                        class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                            stroke-width="2" stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            class="lucide lucide-trash2 lucide-trash-2 w-4 h-4 text-red-600"
                                                            aria-hidden="true">
                                                            <path d="M10 11v6"></path>
                                                            <path d="M14 11v6"></path>
                                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                            <path d="M3 6h18"></path>
                                                            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div> -->

                                <div class="space-y-2 max-h-[500px] overflow-y-auto">
                                    <ng-container formArrayName="concept">
                                        <div *ngFor="let concept of concept.controls; let i = index"
                                            [formGroupName]="i">
                                            <div *ngIf="concept.value.edit"
                                                class="p-4 border rounded-lg bg-amber-50 mb-2">
                                                <h3 class="mb-3 font-semibold">Edit Concept</h3>
                                                <div class="grid grid-cols-2 gap-4">
                                                    <input formControlName="name" class="border p-2 rounded w-full"
                                                        placeholder="Concept Name" />
                                                    <input formControlName="imageUrl" class="border p-2 rounded w-full"
                                                        placeholder="Image URL" />
                                                </div>
                                                <div class="flex gap-2 mt-3">
                                                    <!-- <button (click)="saveConcept(i)" type="button" class="bg-blue-600 text-white px-3 py-1 rounded">Save</button>
                                        <button (click)="concept.patchValue({ edit: false })" type="button" class="bg-gray-300 px-3 py-1 rounded">Cancel</button> -->
                                                    <div class="flex gap-2 mt-4">
                                                        <button  (click)="saveConcept(i)" data-slot="button"
                                                            class="inline-flex bg-[#030213] text-white items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2 has-[&gt;svg]:px-3">Save
                                                            Changes</button>
                                                            <button (click)="concept.patchValue({ edit: false })" data-slot="button"
                                                            class="inline-flex bg-white text-black items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-9 px-4 py-2 has-[&gt;svg]:px-3">Cancel</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div *ngIf="!concept.value.edit"
                                                class="border p-4 rounded-lg flex justify-between items-center bg-white mb-2">
                                                <div class="flex items-center gap-4">
                                                    <img [src]="concept.value.imageUrl" alt=""
                                                        class="w-16 h-16 rounded object-cover">
                                                    <div>
                                                        <p class="font-medium">{{ concept.value.name }}</p>
                                                        <p class="text-sm text-gray-500 truncate max-w-[200px]">{{
                                                            concept.value.imageUrl }}</p>
                                                    </div>
                                                </div>
                                                <div class="flex gap-2">
                                                    <button (click)="editConcept(i)"
                                                        class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                            stroke-width="2" stroke-linecap="round"
                                                            stroke-linejoin="round" class="lucide lucide-pen w-4 h-4"
                                                            aria-hidden="true">
                                                            <path
                                                                d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z">
                                                            </path>
                                                        </svg>
                                                    </button>
                                                    <button (click)="deleteConcept(i)"
                                                        class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 h-8 rounded-md gap-1.5 px-3 has-[&gt;svg]:px-2.5">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                            viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                            stroke-width="2" stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            class="lucide lucide-trash2 lucide-trash-2 w-4 h-4 text-red-600"
                                                            aria-hidden="true">
                                                            <path d="M10 11v6"></path>
                                                            <path d="M14 11v6"></path>
                                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                            <path d="M3 6h18"></path>
                                                            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </ng-container>

                            <!-- Features -->

                            <ng-container *ngIf="selectedTab == 2" formGroupName="features">
                                <div class="space-y-4">
                                    <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border p-4">
                                        <div class="flex items-start gap-3">
                                            <input type="checkbox" id="enablePreSurvey"
                                                formControlName="show_pre_survey" class="mt-1" checked="">
                                            <div class="flex-1">
                                                <label data-slot="label"
                                                    class="flex items-center gap-2 text-sm leading-none font-medium select-none cursor-pointer"
                                                    for="enablePreSurvey">Enable Pre-Survey Questions</label>
                                                <p class="text-gray-600 mt-1">Collect demographic information and
                                                    background
                                                    details before the MaxDiff questions. Includes age, gender, design
                                                    experience, home ownership, and renovation plans.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border p-4">
                                        <div class="flex items-start gap-3">
                                            <input type="checkbox" id="enableProbing" formControlName="show_probing"
                                                class="mt-1" checked="">
                                            <div class="flex-1"><label data-slot="label"
                                                    class="flex items-center gap-2 text-sm leading-none font-medium select-none cursor-pointer"
                                                    for="enableProbing">Enable Probing Questions</label>
                                                <p class="text-gray-600 mt-1">Ask follow-up questions after each MaxDiff
                                                    set
                                                    to gather qualitative insights about why participants made their
                                                    choices. Includes confidence level and detailed reasoning.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border p-4">
                                        <div class="flex items-start gap-3">
                                            <input type="checkbox" id="enablePostSurvey"
                                                formControlName="show_post_survey" class="mt-1" checked="">
                                            <div class="flex-1"><label data-slot="label"
                                                    class="flex items-center gap-2 text-sm leading-none font-medium select-none cursor-pointer"
                                                    for="enablePostSurvey">Enable Post-Survey Questions</label>
                                                <p class="text-gray-600 mt-1">Collect final insights after completing
                                                    all
                                                    MaxDiff questions. Includes overall satisfaction, design priorities,
                                                    budget range, implementation timeline, and feedback.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div data-slot="alert" role="alert"
                                        class="relative w-full rounded-lg border px-4 py-3 text-sm grid has-[&gt;svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[&gt;svg]:gap-x-3 gap-y-0.5 items-start [&amp;&gt;svg]:size-4 [&amp;&gt;svg]:translate-y-0.5 [&amp;&gt;svg]:text-current bg-card text-card-foreground">
                                        <div data-slot="alert-description"
                                            class="text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&amp;_p]:leading-relaxed">
                                            <strong>Best Practice:</strong> We recommend enabling all
                                            features for comprehensive insights. Pre and post-survey questions provide
                                            valuable context for analyzing MaxDiff results, while probing questions
                                            capture
                                            the "why" behind participant choices.
                                        </div>
                                    </div>
                                </div>
                            </ng-container>

                            <!-- Preview -->

                            <ng-container *ngIf="selectedTab == 3">
                                <div class="space-y-4">
                                    <div
                                        class="text-card-foreground flex flex-col gap-6 rounded-xl border p-6 bg-gradient-to-br from-indigo-50 to-blue-50">
                                        <h3 class="text-gray-900 mb-4">Survey Overview</h3>
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div>
                                                <p class="text-gray-600">Title</p>
                                                <p class="text-gray-900">{{surveyForm.get('general.survey_title')?.value}}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600">Total Concepts</p>
                                                <p class="text-gray-900">{{concept.length}}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600">Number of Sets</p>
                                                <p class="text-gray-900">{{surveyForm.get('general.number_sets')?.value}}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600">Concepts Per Set</p>
                                                <p class="text-gray-900">{{surveyForm.get('general.concept_sets')?.value}}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border p-6">
                                        <h3 class="text-gray-900 mb-4">Survey Flow</h3>
                                        <div class="space-y-3">
                                            <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
                                                <div
                                                    class="w-8 h-8 rounded-full bg-blue-200 flex items-center justify-center text-blue-700">
                                                    1</div>
                                                <div>
                                                    <p class="text-gray-900">Pre-Survey</p>
                                                    <p class="text-gray-600">Demographics &amp; background</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3 p-3 bg-indigo-50 rounded-lg">
                                                <div
                                                    class="w-8 h-8 rounded-full bg-indigo-200 flex items-center justify-center text-indigo-700">
                                                    2</div>
                                                <div>
                                                    <p class="text-gray-900">Instructions Cue Card</p>
                                                    <p class="text-gray-600">Survey methodology explanation</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-lg">
                                                <div
                                                    class="w-8 h-8 rounded-full bg-purple-200 flex items-center justify-center text-purple-700">
                                                    3</div>
                                                <div>
                                                    <p class="text-gray-900">MaxDiff Questions (6 sets)</p>
                                                    <p class="text-gray-600">Select best &amp; worst from 5 concepts
                                                        each +
                                                        probing questions</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                                                <div
                                                    class="w-8 h-8 rounded-full bg-green-200 flex items-center justify-center text-green-700">
                                                    4</div>
                                                <div>
                                                    <p class="text-gray-900">Post-Survey</p>
                                                    <p class="text-gray-600">Final insights &amp; preferences</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-3 p-3 bg-amber-50 rounded-lg">
                                                <div
                                                    class="w-8 h-8 rounded-full bg-amber-200 flex items-center justify-center text-amber-700">
                                                    5</div>
                                                <div>
                                                    <p class="text-gray-900">Results Dashboard</p>
                                                    <p class="text-gray-600">Analytics &amp; insights</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-card text-card-foreground flex flex-col gap-6 rounded-xl border p-6">
                                        <h3 class="text-gray-900 mb-4">Sample Concepts</h3>
                                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                                            <ng-container *ngFor="let concept of concepts">
                                                <div class="space-y-2"><img [src]="concept.imageUrl"
                                                        [alt]="concept.name"
                                                        class="w-full aspect-square rounded object-cover">
                                                    <p class="text-gray-900 text-sm truncate">{{concept.name}}</p>
                                                </div>
                                            </ng-container>
                                        </div>
                                        <!-- <p class="text-gray-600 mt-4 text-center">+ 20 more concepts</p> -->
                                    </div>
                                </div>
                            </ng-container>

                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t flex justify-between items-center">
                        <div> <p class="text-red-600 text-sm" *ngIf="(concept?.controls?.length || 0) < 
                    ((surveyForm.get('general.number_sets')?.value || 0) *
                    (surveyForm.get('general.concept_sets')?.value || 0))">
                           *Required {{surveyForm.get('general.number_sets')?.value * surveyForm.get('general.concept_sets')?.value}} concepts
                            </p>
                            </div>
                        <button (click)="submit()" [disabled]="
                    !surveyForm.valid ||
                    (concept?.controls?.length || 0) <
                    ((surveyForm.get('general.number_sets')?.value || 0) *
                    (surveyForm.get('general.concept_sets')?.value || 0))
                "
                            class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*='size-'])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive text-white h-10 rounded-md px-6 has-[&gt;svg]:px-4 bg-indigo-600 hover:bg-indigo-700"><svg
                                xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-play w-5 h-5 mr-2" aria-hidden="true">
                                <path
                                    d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z">
                                </path>
                            </svg>Launch Survey</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>